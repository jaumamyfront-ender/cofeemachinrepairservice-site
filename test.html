<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Карусель в стиле фотоплёнки</title>
    <style>
      :root {
        /* Сколько слайдов видно одновременно (по умолчанию 5 на десктопе) */
        --visible: 5;
        /* Отступ между кадрами */
        --gap: 12px;
        /* Закругление рамок «кадров» */
        --frame-radius: 10px;
        /* Скорость анимации перелистывания */
        --transition-ms: 700ms;
        /* Цвет плёнки */
        --film-color: #111;
        /* Цвет рамки кадра */
        --frame-color: #000;
      }

      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto,
          Helvetica, Arial;
        background: #0b0b0b;
        color: #eaeaea;
        display: grid;
        min-height: 100vh;
        place-items: center;
        padding: 32px 16px;
      }

      .wrap {
        width: min(1200px, 96vw);
      }

      .title {
        margin: 0 0 14px;
        font-weight: 700;
        letter-spacing: 0.2px;
      }

      /* ====== ПЛЁНКА (декор + область слайдов) ====== */
      .filmstrip {
        position: relative;
        background: var(--film-color);
        padding: 28px 18px; /* верх/низ = планки с перфорацией */
        border-radius: 16px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.6),
          inset 0 1px 0 rgba(255, 255, 255, 0.05);
      }

      /* Перфорация сверху и снизу */
      .filmstrip::before,
      .filmstrip::after {
        content: "";
        position: absolute;
        left: 18px;
        right: 18px;
        height: 16px;
        background: radial-gradient(
              circle at 8px 50%,
              rgba(0, 0, 0, 0) 6px,
              rgba(0, 0, 0, 0.9) 7px
            )
            left/40px 100% repeat-x,
          linear-gradient(#222, #050505);
        border-radius: 8px;
        box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.6);
      }
      .filmstrip::before {
        top: 6px;
      }
      .filmstrip::after {
        bottom: 6px;
      }

      .viewport {
        overflow: hidden; /* маска для трека */
        width: 100%;
      }

      .track {
        display: flex;
        gap: var(--gap);
        transition: transform var(--transition-ms) ease;
        will-change: transform;
      }

      .slide {
        position: relative;
        flex: 0 0
          calc((100% - (var(--gap) * (var(--visible) - 1))) / var(--visible));
        border-radius: var(--frame-radius);
        background: var(--frame-color);
        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.5);
        isolation: isolate;
        cursor: pointer;
        aspect-ratio: 3 / 2; /* соотношение сторон кадра */
        overflow: hidden;
      }

      .slide img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: block;
        filter: saturate(1.05) contrast(1.02);
        transition: transform 0.45s ease;
      }
      .slide:hover img {
        transform: scale(1.04);
      }

      /* Маленькие круглые отверстия-имитация по краям кадра (ещё чуть-чуть атмосферы) */
      .slide::before,
      .slide::after {
        content: "";
        position: absolute;
        left: 10px;
        right: 10px;
        height: 6px;
        background: radial-gradient(circle, #0000 2px, #000 3px) left/24px 100%
          repeat-x;
        opacity: 0.55;
        mix-blend-mode: multiply;
        pointer-events: none;
      }
      .slide::before {
        top: 8px;
      }
      .slide::after {
        bottom: 8px;
      }

      /* Управление (опционально) */
      .controls {
        display: flex;
        justify-content: center;
        gap: 12px;
        margin-top: 14px;
        user-select: none;
      }
      .btn {
        background: #1a1a1a;
        border: 1px solid #2a2a2a;
        padding: 10px 14px;
        border-radius: 999px;
        color: #eaeaea;
        cursor: pointer;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.35);
        transition: transform 0.12s ease, background 0.2s ease;
      }
      .btn:active {
        transform: translateY(1px);
      }
      .btn:hover {
        background: #222;
      }

      /* ====== ЛАЙТБОКС ====== */
      .lightbox {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.8);
        display: none; /* через класс .open включаем */
        align-items: center;
        justify-content: center;
        padding: 24px;
        z-index: 50;
        backdrop-filter: blur(2px);
      }
      .lightbox.open {
        display: flex;
      }

      .lightbox__img {
        max-width: min(92vw, 1400px);
        max-height: 86vh;
        width: auto;
        height: auto;
        border-radius: 14px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.7);
      }

      .lightbox__close {
        position: fixed;
        top: 18px;
        right: 18px;
        background: #0f0f0f;
        color: #ddd;
        border: 1px solid #2a2a2a;
        padding: 10px 14px;
        border-radius: 999px;
        cursor: pointer;
        font-size: 14px;
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.45);
      }

      /* ====== РЕСПОНСИВ ====== */
      @media (max-width: 1200px) {
        :root {
          --visible: 4;
        }
      }
      @media (max-width: 900px) {
        :root {
          --visible: 3;
        }
      }
      @media (max-width: 640px) {
        :root {
          --visible: 2;
        }
        .filmstrip {
          padding: 24px 14px;
        }
        .filmstrip::before,
        .filmstrip::after {
          left: 14px;
          right: 14px;
        }
      }
    </style>
  </head>
  <body>
    <div class="wrap">
      <h1 class="title">Карусель «фотоплёнка» — автопрокрутка + лайтбокс</h1>

      <div
        class="filmstrip"
        aria-label="Карусель изображений в стиле фотоплёнки"
      >
        <div class="viewport" id="viewport">
          <div class="track" id="track" aria-live="polite"></div>
        </div>
      </div>

      <div class="controls">
        <button class="btn" id="prev" aria-label="Предыдущие">⟨</button>
        <button class="btn" id="next" aria-label="Следующие">⟩</button>
      </div>
    </div>

    <!-- Лайтбокс -->
    <div
      class="lightbox"
      id="lightbox"
      aria-hidden="true"
      role="dialog"
      aria-label="Просмотр изображения в полном размере"
    >
      <button class="lightbox__close" id="closeLb" aria-label="Закрыть">
        Закрыть ✕
      </button>
      <img class="lightbox__img" id="lightboxImg" alt="Открытое изображение" />
    </div>

    <script>
      // ================== Настройки ==================
      const IMAGES = [
        // Поставьте свои URL или локальные пути. Для примера — Picsum/Unsplash.
        "https://images.unsplash.com/photo-1501785888041-af3ef285b470?q=80&w=1600&auto=format&fit=crop",
        "https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?q=80&w=1600&auto=format&fit=crop",
        "https://images.unsplash.com/photo-1500534314209-a25ddb2bd429?q=80&w=1600&auto=format&fit=crop",
        "https://images.unsplash.com/photo-1470770841072-f978cf4d019e?q=80&w=1600&auto=format&fit=crop",
        "https://images.unsplash.com/photo-1520975922284-5f1d2c36f1a2?q=80&w=1600&auto=format&fit=crop",
        "https://images.unsplash.com/photo-1520974735194-8d95f75768b8?q=80&w=1600&auto=format&fit=crop",
        "https://images.unsplash.com/photo-1519681393784-d120267933ba?q=80&w=1600&auto=format&fit=crop",
        "https://images.unsplash.com/photo-1491553895911-0055eca6402d?q=80&w=1600&auto=format&fit=crop",
        "https://images.unsplash.com/photo-1500043357865-c6b8827edf21?q=80&w=1600&auto=format&fit=crop",
        "https://images.unsplash.com/photo-1500534310680-06894103f1a9?q=80&w=1600&auto=format&fit=crop",
      ];

      const AUTOPLAY_MS = 3000; // интервалы автопрокрутки
      const track = document.getElementById("track");
      const viewport = document.getElementById("viewport");
      const btnPrev = document.getElementById("prev");
      const btnNext = document.getElementById("next");

      // ====== Рендер слайдов ======
      function createSlide(src, idx) {
        const slide = document.createElement("div");
        slide.className = "slide";
        slide.setAttribute("role", "button");
        slide.setAttribute("aria-label", `Открыть изображение ${idx + 1}`);

        const img = document.createElement("img");
        img.src = src;
        img.loading = "lazy";
        img.alt = `Изображение ${idx + 1}`;

        slide.appendChild(img);
        // Клик для открытия лайтбокса
        slide.addEventListener("click", () => openLightbox(src));

        return slide;
      }

      // Инициализация: добавляем все слайды в трек
      IMAGES.forEach((src, i) => track.appendChild(createSlide(src, i)));

      // Клонируем первые n слайдов, чтобы сделать бесконечную прокрутку
      function visibleCount() {
        // вычисляем количество видимых кадров исходя из CSS-переменной
        const rootStyles = getComputedStyle(document.documentElement);
        return parseInt(rootStyles.getPropertyValue("--visible")) || 5;
      }

      function ensureClones() {
        const n = visibleCount();
        // удалим старые клоны
        Array.from(track.querySelectorAll(".slide.clone")).forEach((el) =>
          el.remove()
        );
        for (let i = 0; i < n; i++) {
          const clone = createSlide(IMAGES[i % IMAGES.length], i);
          clone.classList.add("clone");
          track.appendChild(clone);
        }
      }

      ensureClones();
      window.addEventListener("resize", () => ensureClones());

      // ====== Логика сдвига ======
      let index = 0;
      let isAnimating = false;
      let autoplayId = null;

      function slideWidth() {
        // ширина первого слайда (все одинаковые)
        const first = track.querySelector(".slide");
        return first ? first.getBoundingClientRect().width : 0;
      }

      function goToIndex(newIndex) {
        if (isAnimating) return;
        isAnimating = true;
        index = newIndex;
        const dx = -(slideWidth() + gapPx()) * index;
        track.style.transition = `transform var(--transition-ms) ease`;
        track.style.transform = `translate3d(${dx}px,0,0)`;
      }

      function gapPx() {
        const s = getComputedStyle(track);
        return parseFloat(s.gap) || 0;
      }

      function next() {
        goToIndex(index + 1);
      }
      function prev() {
        if (index === 0) {
          // перескакиваем к концу без анимации
          const n = IMAGES.length;
          const w = slideWidth() + gapPx();
          track.style.transition = "none";
          track.style.transform = `translate3d(${-(w * n)}px,0,0)`;
          index = n - 1;
          // в следующем кадре включим анимацию и поедем назад
          requestAnimationFrame(() =>
            requestAnimationFrame(() => goToIndex(index))
          );
        } else {
          goToIndex(index - 1);
        }
      }

      track.addEventListener("transitionend", () => {
        const n = IMAGES.length;
        const vis = visibleCount();
        if (index >= n) {
          // Дошли до клонов: прыгаем в начало без анимации
          track.style.transition = "none";
          index = 0;
          const dx = -(slideWidth() + gapPx()) * index;
          track.style.transform = `translate3d(${dx}px,0,0)`;
        }
        isAnimating = false;
      });

      // Кнопки
      btnNext.addEventListener("click", () => {
        stopAutoplay();
        next();
      });
      btnPrev.addEventListener("click", () => {
        stopAutoplay();
        prev();
      });

      // Автопрокрутка
      function startAutoplay() {
        if (autoplayId) return;
        autoplayId = setInterval(() => next(), AUTOPLAY_MS);
      }
      function stopAutoplay() {
        clearInterval(autoplayId);
        autoplayId = null;
      }

      // Останавливаем на ховер/фокус, возобновляем при уходе
      [viewport, btnNext, btnPrev].forEach((el) => {
        el.addEventListener("mouseenter", stopAutoplay);
        el.addEventListener("mouseleave", startAutoplay);
        el.addEventListener("focusin", stopAutoplay);
        el.addEventListener("focusout", startAutoplay);
      });

      // Стартовое положение
      goToIndex(0);
      startAutoplay();

      // ====== Лайтбокс ======
      const lb = document.getElementById("lightbox");
      const lbImg = document.getElementById("lightboxImg");
      const lbClose = document.getElementById("closeLb");

      function openLightbox(src) {
        lbImg.src = src;
        lb.classList.add("open");
        lb.setAttribute("aria-hidden", "false");
        document.body.style.overflow = "hidden";
      }
      function closeLightbox() {
        lb.classList.remove("open");
        lb.setAttribute("aria-hidden", "true");
        document.body.style.overflow = "";
        // Чтобы очистить src и принудительно перезагрузить на следующее открытие (по желанию):
        // lbImg.src = '';
      }

      lbClose.addEventListener("click", closeLightbox);
      lb.addEventListener("click", (e) => {
        // Закрываем при клике на затемнение (но не по самому изображению)
        if (e.target === lb) closeLightbox();
      });
      window.addEventListener("keydown", (e) => {
        if (e.key === "Escape") closeLightbox();
        if (e.key === "ArrowRight") {
          stopAutoplay();
          next();
        }
        if (e.key === "ArrowLeft") {
          stopAutoplay();
          prev();
        }
      });

      // ====== Свайп для мобильных ======
      let touchStartX = 0;
      viewport.addEventListener(
        "touchstart",
        (e) => {
          touchStartX = e.changedTouches[0].clientX;
          stopAutoplay();
        },
        { passive: true }
      );
      viewport.addEventListener("touchend", (e) => {
        const dx = e.changedTouches[0].clientX - touchStartX;
        if (Math.abs(dx) > 40) {
          if (dx < 0) next();
          else prev();
        } else {
          startAutoplay();
        }
      });
    </script>
  </body>
</html>
